{% extends 'wash/base.html' %}
{% block extra_css %}
    <style>
        .order-img{
            height:90px;
            width:80px;
        }
    </style>
{% endblock %}

    {% block navbar %}
    <ul class="nav nav-tabs text-center">
        <li role="presentation" class="active" value="2"><a href="#">上衣</a></li>
        <li role="presentation" value="3"><a href="#">裤子</a></li>
        <li role="presentation" value="1"><a href="#">鞋</a></li>
        <li role="presentation" value="5"><a href="#">床上用品</a></li>
        <li role="presentation" value="6"><a href="#">其他</a></li>
    </ul>
    {% endblock %}

{% block content %}
<input type="hidden" id="order_count_str" value="{}"/>
<div id="wash_2" class="wash_div" name="true">
    {% for wash in wash_arr %}
    <div class="container-fluid" style="border-bottom:solid 1px #CCCCCC;margin-top:10px;">
        <div clss="row">
            <div class="col-xs-3 text-left">
                <a href="#">
                    <img class="order-img" src="{{ wash.photo }}" alt="...">
                </a>
            </div>
            <div class="col-xs-4">
                <h4 class="media-heading text-left">{{ wash.belong }}</h4>
                <label class="media-heading">{{ wash.name }}</label>
                <h4>
                    <label style="color:red">￥</label><label class="media-heading">{{ wash.new_price }}</label>元({{ wash.measure }})
                </h4>
            </div>
            <div class="col-xs-5 text-right">
                <button type="button" class="btn btn-default btn-sm" onclick="order_minus({{ wash.id }})">
                  <span class="glyphicon glyphicon-minus" aria-hidden="true"></span>
                </button>
                <label id="wash_count_{{ wash.id }}">
                    0
                </label>
                <button type="button" class="btn btn-default btn-sm" onclick="order_add({{ wash.id }})">
                  <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                </button>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
<div id="wash_1" class="wash_div"></div>
<div id="wash_3" class="wash_div"></div>
<div id="wash_5" class="wash_div"></div>
<div id="wash_6" class="wash_div"></div>

{% endblock %}

{% block show %}on{% endblock %}

{% block extra_js %}
<script>
    // tab切换
    $(".nav li").click(function(){
        $(".nav li").removeClass("active");
        $(this).addClass("active");
        var belong = $(this).attr("value");
        var value = $("#wash_"+belong).attr("name");
        if(value != 'true'){
            get_show_info(belong);
        }else{
            $(".wash_div").css("display", "none");
            $("#wash_"+belong).css("display", "");
        }
    });

    // 获取tab下内容
    function get_show_info(belong){
        var _data = {};
        $.ajax({
            type: 'get',
            dataType: "json",
            url: "{% url 'wash_show'%}",
            data: {'belong': belong},
            success: function(Data) {
                if (Data['status']) {
                    $(".wash_div").css("display", "none");
                    $("#wash_"+belong).css("display", "");
                    $("#wash_"+belong).attr("name", "true");
                    for(i=0;i<Data['result'].length;i++){
                        var d = Data['result'][i];
                        var html = "<div class='container-fluid' style='border-bottom:solid 1px #CCCCCC;margin-top:10px;'>"+
                                        "<div clss='row'>"+
                                            "<div class='col-xs-3 text-left'>"+
                                                "<a href='#'><img class='order-img' src='"+ d['photo'] +"' alt='...'></a>"+
                                            "</div>"+
                                            "<div class='col-xs-4'>"+
                                               "<h4 class='media-heading text-left'>"+ d['name'] +"</h4>"+
                                                "<label class='media-heading'>"+ d['belong'] +"</label>"+
                                                "<h4>"+
                                                    "<label style='color:red'>￥</label><label class='media-heading'>"+ d['new_price'] +"</label>元("+ d['measure'] +")"+
                                                "</h4>"+
                                            "</div>"+
                                            "<div class='col-xs-5 text-right'>"+
                                                "<button type='button' class='btn btn-default btn-sm' style='margin-right:4px;' onclick='order_minus("+ d['id'] +")'>"+
                                                  "<span class='glyphicon glyphicon-minus' aria-hidden='true'></span>"+
                                                 " </button><label id='wash_count_"+ d['id'] +"'>0</label><button type='button' class='btn btn-default btn-sm add' style='margin-left:4px;' onclick='order_add("+ d['id'] +")'>"+
                                                 "<span class='glyphicon glyphicon-plus' aria-hidden='true'></span></button></div></div>";
                        $("#wash_"+belong).append(html);
                    }
                } else {
                    alert("error");
                }
            }
        });
    };

    // 数量增加一
    function order_add(wash_id){
        var d = $("#order_count_str").val();
        update_order_json(d, "wash"+wash_id, true)

        $("#order_count").css("display", "");
        $("#order_count").html(parseInt($("#order_count").html())+1);
        var wash_count = $("#wash_count_"+wash_id).html();
        $("#wash_count_"+wash_id).html(parseInt(wash_count)+1);
    }

    // 数量减一
    function order_minus(wash_id){
        var wash_count = parseInt($("#wash_count_"+wash_id).html());
        var order_count = parseInt($("#order_count").html());
        if(wash_count>0){
            $("#wash_count_"+wash_id).html(parseInt(wash_count)-1);
        }
        if (order_count-1==0){
            $("#order_count").css("display", "none");
        }else if(order_count>0){
            $("#order_count").html(parseInt($("#order_count").html())-1);
        }

        if(wash_count > 0 && order_count>0){
            var d = $("#order_count_str").val();
            update_order_json(d, "wash"+wash_id, false)
        }
    }

    // 订单信息修改
    function update_order_json(d, key, flag){
        var _d = eval('('+d+')');
        if(_d[key] == undefined){
            _d[key] = '1';
        }else{
            if(flag){
               _d[key] = (parseInt(_d[key]) + 1).toString();
            }else{
               _d[key] = (parseInt(_d[key]) - 1).toString();
            }
        }
        var order_str = JSON.stringify(_d);
        $("#order_count_str").val(order_str);
    }

</script>
{% endblock %}