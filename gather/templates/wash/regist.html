{% extends 'wash/base.html' %}

{% block extra_css %}
<style>
    .form-control {
        position: relative;
        height: auto;
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
        padding: 10px;
        font-size: 16px;
    }
    .form-control:focus {
        z-index: 2;
    }
    input {
        margin-bottom: -1px;
        border-bottom-right-radius: 0;
        border-bottom-left-radius: 0;
    }
    </style>
{% endblock %}

{% block content %}
    <div class="list-group">
        <div href="#" class="list-group-item text-center">
            <h4><a>登录</a></h4>
       </div>
    </div>
    <form action="." method="post">
        {% csrf_token %}
        <div class="row-fluid">
            <div class="col-xs-12">
                <input type="number" placeholder="请输入手机号" name="phone" id="id_phone" class="form-control">
            </div>
        </div>
        <br><br>
        <div class="row-fluid" style="margin-top:20px;">
           <div class="col-xs-8">
              <input class="form-control" name="code" id="input_code" type="number" placeholder="验证码">
           </div>
            <div class="col-xs-4">
              <button type="button" class="btn btn-info" id="verify_code" style="margin-top:5px;">获取验证码</button>
           </div>
        </div>
        <br>
        <div class="row-fluid" style="margin-top:40px;margin-bottom:100px;">
           <div class="col-xs-12">
               <button type="submit" class="btn btn-success btn-lg btn-block">登录</button>
           </div>
        </div>
    </form>
    {% if form.phone.errors %}
        {% for error in form.phone.errors %}
    <div class="alert alert-danger text-center" role="alert">{{ error }}</div>
        {% endfor %}
    {% elif form.code.errors %}
        {% for error in form.code.errors %}
    <div class="alert alert-danger text-center" role="alert">{{ error }}</div>
        {% endfor %}
    {% else %}
        {% for error in form.non_field_errors %}
    <div class="alert alert-danger text-center" role="alert">{{ error }}</div>
        {% endfor %}
    {% endif %}

    <div class="alert alert-success text-center" role="alert" style="display:none" id="send_succ">
        发送成功!您将收到一条&nbsp;&nbsp;<span class="label label-danger">语音</span>&nbsp;&nbsp;验证码
    </div>
    <div class="alert alert-danger text-center" role="alert" style="display:none" id="send_err">
        网络错误, 请重试!
    </div>
{% endblock %}

{% block index %}on{% endblock %}

{% block extra_js %}
<script>
    $("#verify_code").click(function(){
        $(".alert").css("display", "none");
        var phone = $("#id_phone").val();
        if(isNaN(phone) || phone.length != 11){
            $("#send_err").html("手机号码格式错误");
            $("#send_err").css("display", "block");
        }else{
            $("#verify_code").addClass("disabled");
            $("#verify_code").html("发送中...");
        }
        $.ajax({
            type: 'post',
            dataType: "json",
            url: "{% url 'wash_verify'%}",
            data: {'phone': phone},
            success: function(data) {
                if(data['result']){
                    $("#send_succ").css("display", "block");
                    if(data['msg'] == 'login'){
                        location.href = '/wash/';
                    }
                }else{
                    $("#send_err").html(data['msg']);
                    $("#send_err").css("display", "block");
                }
            },
            error: function(){
                $("#send_err").css("display", "block");
            }
        });

    });
</script>
{% endblock %}